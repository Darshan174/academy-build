<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=alternate type=application/json href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/scheduling/index.json><meta name=robots content="index, follow"><link rel="shortcut icon" href=https://cloud.layer5.io/academy/favicons/favicon.ico><link rel=apple-touch-icon href=https://cloud.layer5.io/academy/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-192x192.png sizes=192x192><title>Scheduling Pods | Layer5 Academy</title><meta name=description content="Learn Pod placement strategies using labels, taints, affinities and more."><meta property="og:url" content="https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/scheduling/"><meta property="og:site_name" content="Layer5 Academy"><meta property="og:title" content="Scheduling Pods"><meta property="og:description" content="Learn Pod placement strategies using labels, taints, affinities and more."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Scheduling Pods"><meta itemprop=description content="Learn Pod placement strategies using labels, taints, affinities and more."><meta itemprop=wordCount content="1114"><meta name=twitter:card content="summary"><meta name=twitter:title content="Scheduling Pods"><meta name=twitter:description content="Learn Pod placement strategies using labels, taints, affinities and more."><link rel=preload href=https://cloud.layer5.io/academy/scss/main.min.8d61368d36274adb6675933a7937cfa090b823abdb581eede811dfeab0c3628e.css as=style integrity="sha256-jWE2jTYnSttmdZM6eTfPoJC4I6vbWB7t6BHf6rDDYo4=" crossorigin=anonymous><link href=https://cloud.layer5.io/academy/scss/main.min.8d61368d36274adb6675933a7937cfa090b823abdb581eede811dfeab0c3628e.css rel=stylesheet integrity="sha256-jWE2jTYnSttmdZM6eTfPoJC4I6vbWB7t6BHf6rDDYo4=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="form-control td-search__input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=https://cloud.layer5.io/academy/offline-search-index.f16c09dddb81ca89db2c4b5cb89e7f49.json data-offline-search-base-href=https://cloud.layer5.io/academy/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prep-li><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prep><span>Certified Kubernetes Administrator (CKA) Preparation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentcertifications-li><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/certifications/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentcertifications><span>Certifications</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentcreation-li><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/creation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentcreation><span>Create a cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentworkload-li><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/workload/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentworkload><span>Workloads</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentscheduling-li><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/scheduling/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__section" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentscheduling><span class=td-sidebar-nav-active-item>Scheduling Pods</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentnetworking-li><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/networking/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentnetworking><span>Networking</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentstorage-li><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/storage/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentstorage><span>Storage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentsecurity-li><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/security/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentsecurity><span>Security</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontenttroubleshooting-li><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/troubleshooting/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontenttroubleshooting><span>Troubleshooting</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentoperations-li><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/operations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths98e16360-a366-4b78-8e0a-031da07fdacbcka-prepcontentoperations><span>Operations</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div></aside><main class="col-12 col-md-9 col-xl-8" role=main><div class="page-header d-flex justify-content-between align-items-center"><div class=breadcrumb-container><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/>Learning Paths</a></li><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/>Certified Kubernetes Administrator (CKA) Preparation</a></li><li class="breadcrumb-item active" aria-current=page>Scheduling Pods</li></ol></nav></div></div><div class=td-content><h1>Scheduling Pods</h1><div class=lead>Learn Pod placement strategies using labels, taints, affinities and more.</div><header class=article-meta><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 6 minute read &nbsp;</p></header><p>This section is a refresher that provides an overview of the main properties involved in the scheduling phase. At the end of this section, please complete the exercises to apply these concepts.</p><h2 id=purpose class=heading-link>Purpose
<a href=#purpose class=heading-anchor aria-label="Permalink to this heading">🔗</a></h2><hr><p>The scheduling step is where Kubernetes decides on which Node a Pod will run on. The Scheduler, running on the control plane, is the process in charge of this action.</p><p><div class=md__image><img id="[142 302 23 1 120 385]" src=scheduling.png onclick=openModal(this.id) alt=scheduling class=md-image-responsive></div></p><p>There are various properties/items which can influence the scheduling decision, including:</p><ul><li><code>nodeName</code></li><li><code>nodeSelector</code></li><li><code>nodeAffinity</code></li><li><code>podAffinity / podAntiAffinity</code></li><li><code>topologySpreadConstraints</code></li><li><code>taint / toleration</code></li><li><code>available resources</code></li><li><code>priorityClass</code></li><li><code>runtimeClass</code></li></ul><h2 id=nodename class=heading-link>nodeName
<a href=#nodename class=heading-anchor aria-label="Permalink to this heading">🔗</a></h2><hr><p>The <code>nodeName</code> property bypasses the scheduling process, indicating directly in the Pod&rsquo;s specification the name of the Node this Pod must be deployed to.</p><p><div class=md__image><img id="[37 189 394 172 341 95]" src=nodeName.png onclick=openModal(this.id) alt=nodeName class=md-image-responsive></div></p><h2 id=nodeselector class=heading-link>nodeSelector
<a href=#nodeselector class=heading-anchor aria-label="Permalink to this heading">🔗</a></h2><hr><p>The <code>nodeSelector</code> property uses Node&rsquo;s labels to schedule a Pod.</p><p><div class=md__image><img id="[275 36 489 344 24 484]" src=nodeSelector.png onclick=openModal(this.id) alt=nodeSelector class=md-image-responsive></div></p><h2 id=nodeaffinity class=heading-link>nodeAffinity
<a href=#nodeaffinity class=heading-anchor aria-label="Permalink to this heading">🔗</a></h2><hr><p>The <code>nodeAffinity</code> property also uses Node&rsquo;s label. Still, it is more granular than <code>nodeSelector</code> as it can use the following operators on the labels: <strong>In</strong>, <strong>NotIn</strong>, <strong>Exists</strong>, <strong>DoesNotExist</strong>, <strong>Gt</strong>, and <strong>Lt</strong>.</p><p>Two rules are available when using <code>nodeAffinity</code>:</p><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code> defines a <strong>hard constraint</strong>: if the scheduler does not manage to schedule the Pod according to the specification, then the Pod will remain in Pending</li><li><code>preferredDuringSchedulingIgnoredDuringExecution</code> defines a <strong>soft constraint</strong>: if the scheduler does not manage to schedule the Pod, according to the specification, then it will do its best to schedule it anyway, even if the requirements are not satisfied</li></ul><h3 id=example class=heading-link>Example:
<a href=#example class=heading-anchor aria-label="Permalink to this heading">🔗</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>affinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nodeAffinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>nodeSelectorTerms</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes.io/e2e-az-name Pod must be scheduled on a node having the label</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In kubernetes.io/e2e-az-name with the value e2e-az1 or e2e-az2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>e2e-az1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>e2e-az2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>preferredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>weight</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>preference</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w> </span><span class=l>Pod preferably scheduled on a node having the label</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>disktype disktype with the value ssd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>ssd</span><span class=w>
</span></span></span></code></pre></div><h2 id=podaffinity--podantiaffinity class=heading-link>podAffinity / podAntiAffinity
<a href=#podaffinity--podantiaffinity class=heading-anchor aria-label="Permalink to this heading">🔗</a></h2><hr><p>We use the <code>podAffinity</code> and <code>podAntiAffinity</code> properties to schedule a Pod based on the labels of already existing Pods.</p><p>It uses the same rules as the <code>nodeAffinity</code> property:</p><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code> defines a <strong>hard constraint</strong></li><li><code>preferredDuringSchedulingIgnoredDuringExecution</code> defines a <strong>soft constraint</strong></li></ul><p>It also uses a property named <code>topologyKey</code> to specify geographical preferences (among other things):</p><ul><li><code>hostname</code></li><li><code>region</code></li><li><code>az</code></li><li>&mldr;</li></ul><h3 id=example-1 class=heading-link>Example 1
<a href=#example-1 class=heading-anchor aria-label="Permalink to this heading">🔗</a></h3><p>The following Deployment&rsquo;s Pods cannot all be created on a cluster with less than 4 Nodes as it specifies that two Pods with the <code>app: cache</code> label must not be on the same Node.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis:6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>affinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>podAntiAffinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>labelSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>topologyKey</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kubernetes.io/hostname&#34;</span><span class=w>
</span></span></span></code></pre></div><h3 id=example-2 class=heading-link>Example 2
<a href=#example-2 class=heading-anchor aria-label="Permalink to this heading">🔗</a></h3><p>The following specification illustrates the usage of both <code>podAffinity</code> and <code>podAntiAffinity</code> properties.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>affinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>podAffinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w> </span><span class=l>Pod must be scheduled on a node which is in the availability</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>labelSelector: zone where already exists a Pod with the label security</span><span class=p>:</span><span class=w> </span><span class=l>S1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>security</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>S1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>topologyKey</span><span class=p>:</span><span class=w> </span><span class=l>failure-domain.beta.kubernetes.io/zone</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>podAntiAffinity</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>preferredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w> </span><span class=l>Pod should not be scheduled on a node where already exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>podAffinityTerm: a Pod with the label security</span><span class=p>:</span><span class=w> </span><span class=l>S2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>labelSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>security</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=l>S2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>topologyKey</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes.io/hostname</span><span class=w>
</span></span></span></code></pre></div><h2 id=topologyspreadconstraints class=heading-link>TopologySpreadConstraints
<a href=#topologyspreadconstraints class=heading-anchor aria-label="Permalink to this heading">🔗</a></h2><hr><p>The <code>topologySpreadConstraints</code> property defines how to spread Pods across a cluster topology, ensuring application resiliency.</p><p>The following Deployment uses the <code>topologySpreadConstraints</code> property to ensure Pods are correctly balanced between AZ and Node.</p><p><div class=md__image><img id="[387 93 72 278 166 447]" src=topologySpreadConstraint.png onclick=openModal(this.id) alt=topologySpreadConstraint class=md-image-responsive></div></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.24</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>topologySpreadConstraints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>maxSkew</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=l>The difference in the number of matching Pods between</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>topologyKey</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kubernetes.io/hostname&#34;</span><span class=w> </span><span class=l>any two nodes should be no more than 1 (maxSkew)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>whenUnsatisfiable</span><span class=p>:</span><span class=w> </span><span class=l>ScheduleAnyway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>labelSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>maxSkew</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=l>Ensures that the Pods are spread across different</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>topologyKey</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;topology.kubernetes.io/zone&#34;</span><span class=w> </span><span class=l>availability zones</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>whenUnsatisfiable</span><span class=p>:</span><span class=w> </span><span class=l>ScheduleAnyway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>labelSelector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span></code></pre></div><h2 id=taints--tolerations class=heading-link>Taints & Tolerations
<a href=#taints--tolerations class=heading-anchor aria-label="Permalink to this heading">🔗</a></h2><hr><p>In contrast to the properties we saw earlier, we use a <strong>Taint</strong> to prevent certain Pods from being scheduled on a node. A Pod must tolerate a Taint, using a <code>toleration</code> property, to be scheduled on a Node having that Taint.</p><p>A Taint has 3 properties:</p><ul><li><code>key</code>: it can be arbitrary string content, same format as labels</li><li><code>value</code>: it can be an arbitrary string content, same format as labels</li><li><code>effect</code>: among <code>NoSchedule</code>, <code>PreferNoSchedule</code> and <code>NoExecute</code></li></ul><p>By default, a kubeadm cluster sets a Taint on the control plane Nodes. This Taint prevents a Pod from being deployed on these Nodes unless the Pod explicitly tolerates this Taint.</p><p>The following command lists the Taints existing on the controlplane Node.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get no controlplane -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.taints}&#39;</span> <span class=p>|</span> jq
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>  <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;effect&#34;</span>: <span class=s2>&#34;NoSchedule&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;key&#34;</span>: <span class=s2>&#34;node-role.kubernetes.io/control-plane&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></div><p>When creating the following Deployment, with 10 replicas of nginx Pods, none of the Pods will land on the controlplane because of this specific Taint.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.24</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span></code></pre></div><p>We must add a toleration for the Taint, so the scheduler can schedule Pods on the controlplane.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>www</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tolerations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>node-role.kubernetes.io/control-plane</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=l>NoSchedule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.24</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span></code></pre></div><h2 id=priorityclass class=heading-link>PriorityClass
<a href=#priorityclass class=heading-anchor aria-label="Permalink to this heading">🔗</a></h2><hr><p>A <code>PriorityClass</code> is a Kubernetes resource that defines the priority of Pods. It influences scheduling decisions and preemption - meaning that higher-priority Pods can evict lower-priority ones if resources are scarce. A PriorityClass can be preempting (default behavior) or non-preempting, depending on the <code>preemtionPolicy</code> property.</p><p>The following specifications define a high-priority PriorityClass and a Pod using it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>scheduling.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>PriorityClass</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>high-priority</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=m>1000000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>globalDefault</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>priorityClassName</span><span class=p>:</span><span class=w> </span><span class=l>high-priority</span><span class=w>
</span></span></span></code></pre></div><h2 id=runtimeclass class=heading-link>RuntimeClass
<a href=#runtimeclass class=heading-anchor aria-label="Permalink to this heading">🔗</a></h2><hr><p>A <code>RuntimeClass</code> allows to have multiple container runtimes in the cluster, and to select the one which best fits a workload. There are several container runtimes, each one of them addresses specific use cases, including:</p><ul><li><a href=https://containerd.io/>Containerd</a> is a general-purpose container runtime (CNCF Graduated)</li><li><a href=https://github.com/cri-o/cri-o>CRI-O</a> is a light container runtime focusing on Kubernetes (CNCF Graduated)</li><li><a href=https://gvisor.dev/>GVisor</a> is used to run an unsecure workload in a sandbox</li><li><a href=https://katacontainers.io/>Kata-Container</a> uses Micro VMs for workload isolation</li><li><a href=https://firecracker-microvm.github.io/>Firecracker</a> uses Micro VMs, mainly for serverless</li><li><a href=https://wasmedge.org/>WasmEdge</a> is dedicated to run Wasm workload</li></ul><p>In a Pod specification, we can specify the container runtime configuration needed by this workload. The scheduler ensures that Pods are placed on Nodes that support the required container runtime configuration.</p><p>Let&rsquo;s say our cluster already has a RuntimeClass named <code>gvisor</code>, then we can use it in the Pod specification as follows.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>runtimeClass</span><span class=p>:</span><span class=w> </span><span class=l>gvisor</span><span class=w>
</span></span></span></code></pre></div><div class=section-index></div><nav class="pagination-nav mt-5" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/workload/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label><i class="fa fa-chevron-left"></i> Workloads</div></a><a class="pagination-nav__link pagination-nav__link--next" href=https://cloud.layer5.io/academy/learning-paths/98e16360-a366-4b78-8e0a-031da07fdacb/cka-prep/content/networking/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Networking <i class="fa fa-chevron-right"></i></div></a></nav></div></main></div></div></div><script src=https://cloud.layer5.io/academy/js/main.min.93a3bf75eba7f67cb62933bdc16aff4dc235ec3930d0090a0bdf2a9941f29237.js integrity="sha256-k6O/deun9ny2KTO9wWr/TcI17Dkw0AkKC98qmUHykjc=" crossorigin=anonymous></script><script defer src=https://cloud.layer5.io/academy/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=https://cloud.layer5.io/academy/js/tabpane-persist.js></script><div id=myModal class=modal><button class=modal-close onclick=closeModal()>close</button><div class=modal-cont><img class=modal-pic id=modalPic onclick=closeModal() style=max-width:100%;max-height:80vh;margin:auto alt=Modal-pic></div></div><script>function openModal(e){var t;typeof e=="string"?t=document.getElementById(e).src:e instanceof HTMLImageElement&&(t=e.src),t&&t.includes("#")&&(t=t.substring(0,t.indexOf("#"))),document.getElementById("modalPic").src=t,document.getElementById("myModal").style.display="block"}function closeModal(){document.getElementById("modalPic").src="",document.getElementById("myModal").style.display="none"}document.addEventListener("keydown",function(e){e.key==="Escape"&&closeModal()}),document.addEventListener("DOMContentLoaded",function(){var e,t=document.querySelectorAll("img");t.forEach(function(e){e.onclick=function(){e.dataset.modal!=="false"&&openModal(e)}}),e=document.getElementById("myModal"),e.addEventListener("click",function(){closeModal()})})</script></body></html>