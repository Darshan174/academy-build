<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=https://cloud.layer5.io/academy/favicons/favicon.ico><link rel=apple-touch-icon href=https://cloud.layer5.io/academy/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-192x192.png sizes=192x192><title>Exposing services through Istio Ingress Gateway | Layer5 Academy</title><meta name=description content="Meshery, collaborative Kubernetes manager"><meta property="og:url" content="https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/expose-services/"><meta property="og:site_name" content="Layer5 Academy"><meta property="og:title" content="Exposing services through Istio Ingress Gateway"><meta property="og:description" content="Meshery, collaborative Kubernetes manager"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="learning-paths"><meta itemprop=name content="Exposing services through Istio Ingress Gateway"><meta itemprop=description content="Meshery, collaborative Kubernetes manager"><meta itemprop=wordCount content="913"><meta name=twitter:card content="summary"><meta name=twitter:title content="Exposing services through Istio Ingress Gateway"><meta name=twitter:description content="Meshery, collaborative Kubernetes manager"><link rel=preload href=https://cloud.layer5.io/academy/scss/main.min.8d61368d36274adb6675933a7937cfa090b823abdb581eede811dfeab0c3628e.css as=style integrity="sha256-jWE2jTYnSttmdZM6eTfPoJC4I6vbWB7t6BHf6rDDYo4=" crossorigin=anonymous><link href=https://cloud.layer5.io/academy/scss/main.min.8d61368d36274adb6675933a7937cfa090b823abdb581eede811dfeab0c3628e.css rel=stylesheet integrity="sha256-jWE2jTYnSttmdZM6eTfPoJC4I6vbWB7t6BHf6rDDYo4=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="form-control td-search__input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=https://cloud.layer5.io/academy/offline-search-index.94a3a33c75bba8d6f2c5d5bab9ea1aaf.json data-offline-search-base-href=https://cloud.layer5.io/academy/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developers-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developers><span>Mastering Service Meshes for Developers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshes-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshes><span>Introduction to Service Meshes</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesgetting-started-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesgetting-started><span>Getting Started with Istio</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesdeploy-an-application-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/deploy-an-application/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesdeploy-an-application><span>Deploy a Sample Application</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesexpose-services-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/expose-services/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesexpose-services><span class=td-sidebar-nav-active-item>Exposing services through Istio Ingress Gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesobservability-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/observability/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesobservability><span>Observability</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesrouting-and-canary-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/routing-and-canary/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesrouting-and-canary><span>Request Routing and Canary Testing</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesfault-injection-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/fault-injection/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesfault-injection><span>Fault Injection</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesmutual-tls-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/mutual-tls/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesmutual-tls><span>Mutual TLS & Identity Verification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshescircuit-breaking-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/circuit-breaking/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshescircuit-breaking><span>Circuit Breaking</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesconclusion-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/conclusion/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesconclusion><span>Conclusion</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshes-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshes><span>Advance Concepts of Service Meshes</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesgetting-started-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesgetting-started><span>Getting Started with Istio</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesdeploy-an-application-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/deploy-an-application/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesdeploy-an-application><span>Deploy a sample application</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesexpose-services-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/expose-services/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesexpose-services><span>Expose services through Istio Ingress Gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesservice-security-capabilities-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/service-security-capabilities/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesservice-security-capabilities><span>Service Security Capabilities of Istio</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-mesheswebassembly-and-intelligent-data-planes-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/webassembly-and-intelligent-data-planes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-mesheswebassembly-and-intelligent-data-planes><span>WebAssembly and Intelligent Data Planes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesconclusion-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/conclusion/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesconclusion><span>Conclusion</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesobservability-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/observability/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesobservability><span>Observability with Istio</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div></aside><main class="col-12 col-md-9 col-xl-8" role=main><div class="page-header d-flex justify-content-between align-items-center"><div class=breadcrumb-container><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/>Learning Paths</a></li><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/>Mastering Service Meshes for Developers</a></li><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/>Introduction to Service Meshes</a></li><li class="breadcrumb-item active" aria-current=page>Exposing services through Istio Ingress Gateway</li></ol></nav></div></div><div class=td-content data-bs-theme=dark><h1>Exposing services through Istio Ingress Gateway</h1><div class=lead>Meshery, collaborative Kubernetes manager</div><header class=article-meta><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 5 minute read &nbsp;</p></header><div class=chapter-content><p>The components deployed on the service mesh by default are not exposed outside the cluster. An Ingress Gateway is deployed as a Kubernetes service of type LoadBalancer (or NodePort). To make Bookinfo accessible external to the cluster, you have to create an <code>Istio Gateway</code> for the Bookinfo application and also define an <code>Istio VirtualService</code> with the routes we need.</p><h3 id=inspecting-the-istio-ingress-gateway class=heading-link><strong>Inspecting the Istio Ingress Gateway</strong>
<a href=#inspecting-the-istio-ingress-gateway class=heading-anchor aria-label="Permalink to this heading">🔗</a></h3><br>The ingress gateway gets exposed as a normal Kubernetes service of type LoadBalancer (or NodePort):<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get svc istio-ingressgateway -n istio-system -o yaml
</span></span></code></pre></div><p>Because the Istio Ingress Gateway is an Envoy Proxy you can inspect it using the admin routes. First find the name of the istio-ingressgateway:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get pods -n istio-system
</span></span></code></pre></div><p>Copy and paste your ingress gateway&rsquo;s pod name. Execute:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system <span class=nb>exec</span> -it &lt;istio-ingressgateway-...&gt; bash
</span></span></code></pre></div><p>You can view the statistics, listeners, routes, clusters and server info for the Envoy proxy by forwarding the local port:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl localhost:15000/help
</span></span><span class=line><span class=cl>curl localhost:15000/stats
</span></span><span class=line><span class=cl>curl localhost:15000/listeners
</span></span><span class=line><span class=cl>curl localhost:15000/clusters
</span></span><span class=line><span class=cl>curl localhost:15000/server_info
</span></span></code></pre></div><p>See the <a href=https://www.envoyproxy.io/docs/envoy/latest/operations/admin>admin docs</a> for more details.</p><p>Also it can be helpful to look at the log files of the Istio ingress controller to see what request is being routed.</p><p>Before we check the logs, let us get out of the container back on the host:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>exit</span>
</span></span></code></pre></div><p>Now let us find the ingress pod and output the log:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl logs istio-ingressgateway-... -n istio-system
</span></span></code></pre></div><h3 id=view-istio-ingress-gateway-for-bookinfo class=heading-link><strong>View Istio Ingress Gateway for Bookinfo</strong>
<a href=#view-istio-ingress-gateway-for-bookinfo class=heading-anchor aria-label="Permalink to this heading">🔗</a></h3><br><h4 id=view-the-gateway-and-virtualservices class=heading-link><strong>View the Gateway and VirtualServices</strong>
<a href=#view-the-gateway-and-virtualservices class=heading-anchor aria-label="Permalink to this heading">🔗</a></h4><p>Check the created <code>Istio Gateway</code> and <code>Istio VirtualService</code> to see the changes deployed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get gateway
</span></span><span class=line><span class=cl>kubectl get gateway -o yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get virtualservices
</span></span><span class=line><span class=cl>kubectl get virtualservices -o yaml
</span></span></code></pre></div><h4 id=find-the-external-port-of-the-istio-ingress-gateway-by-running class=heading-link><strong>Find the external port of the Istio Ingress Gateway by running:</strong>
<a href=#find-the-external-port-of-the-istio-ingress-gateway-by-running class=heading-anchor aria-label="Permalink to this heading">🔗</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get service istio-ingressgateway -n istio-system -o wide
</span></span></code></pre></div><p>To just get the first port of istio-ingressgateway service, we can run this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get service istio-ingressgateway -n istio-system --template<span class=o>=</span><span class=s1>&#39;{{(index .spec.ports 1).nodePort}}&#39;</span>
</span></span></code></pre></div><h4 id=create-a-dns-entry class=heading-link><strong>Create a DNS entry:</strong>
<a href=#create-a-dns-entry class=heading-anchor aria-label="Permalink to this heading">🔗</a></h4><p>Modify you local <code>/etc/hosts</code> file to add an entry for your sample application.</p><p><code>127.0.0.1. bookinfo.meshery.io</code></p><p>The HTTP port is usually 31380.</p><p>Or run these commands to retrieve the full URL:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;http://</span><span class=k>$(</span>kubectl get nodes --selector<span class=o>=</span>kubernetes.io/role!<span class=o>=</span>master -o <span class=nv>jsonpath</span><span class=o>={</span>.items<span class=o>[</span>0<span class=o>]</span>.status.addresses<span class=o>[</span>?<span class=se>\(</span>@.type<span class=o>==</span><span class=se>\&#34;</span>InternalIP<span class=se>\&#34;\)</span><span class=o>]</span>.address<span class=o>}</span><span class=k>)</span><span class=s2>:</span><span class=k>$(</span>kubectl get svc istio-ingressgateway -n istio-system -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.ports[1].nodePort}&#39;</span><span class=k>)</span><span class=s2>/productpage&#34;</span>
</span></span></code></pre></div><p>Docker Desktop users please use <code>http://localhost/productpage</code> to access product page in your browser.</p><p>In case you are using a managed kubernetes cluster like AKS, EKS, or GCE please follow the procedure described below:</p><ul><li><p>Get the external IP of the service istio-ingressgateway using the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get service istio-ingressgateway -n istio-system
</span></span></code></pre></div></li><li><p>Using Meshery, navigate to the Custom yaml page, and apply the manifest given below to allow all hosts instead of allowing bookinfo.meshery.io only and you are good to access the page using the following url <code>http://&lt;external-ip of istio-ingressgateway>/productpage</code>.</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.istio.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>VirtualService</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>bookinfo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>gateways</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sample-app-gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=s2>&#34;*&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>match</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>uri</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>exact</span><span class=p>:</span><span class=w> </span><span class=l>/productpage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>uri</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=l>/static</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>uri</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>exact</span><span class=p>:</span><span class=w> </span><span class=l>/login</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>uri</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>exact</span><span class=p>:</span><span class=w> </span><span class=l>/logout</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>uri</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=l>/api/v1/products</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>route</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>destination</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>productpage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>9080</span><span class=w>
</span></span></span></code></pre></div><h3 id=apply-default-destination-rules class=heading-link><strong>Apply default destination rules</strong>
<a href=#apply-default-destination-rules class=heading-anchor aria-label="Permalink to this heading">🔗</a></h3><p>Before we start playing with Istio&rsquo;s traffic management capabilities we need to define the available versions of the deployed services. They are called subsets, in destination rules.</p><p>Using Meshery, navigate to the Custom yaml page, and apply the below to create the subsets for BookInfo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>apiVersion: networking.istio.io/v1alpha3
</span></span><span class=line><span class=cl>kind: DestinationRule
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: productpage
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  host: productpage
</span></span><span class=line><span class=cl>  subsets:
</span></span><span class=line><span class=cl>    - name: v1
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        version: v1
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: networking.istio.io/v1alpha3
</span></span><span class=line><span class=cl>kind: DestinationRule
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: reviews
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  host: reviews
</span></span><span class=line><span class=cl>  subsets:
</span></span><span class=line><span class=cl>    - name: v1
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        version: v1
</span></span><span class=line><span class=cl>    - name: v2
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        version: v2
</span></span><span class=line><span class=cl>    - name: v3
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        version: v3
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: networking.istio.io/v1alpha3
</span></span><span class=line><span class=cl>kind: DestinationRule
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: ratings
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  host: ratings
</span></span><span class=line><span class=cl>  subsets:
</span></span><span class=line><span class=cl>    - name: v1
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        version: v1
</span></span><span class=line><span class=cl>    - name: v2
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        version: v2
</span></span><span class=line><span class=cl>    - name: v2-mysql
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        version: v2-mysql
</span></span><span class=line><span class=cl>    - name: v2-mysql-vm
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        version: v2-mysql-vm
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>apiVersion: networking.istio.io/v1alpha3
</span></span><span class=line><span class=cl>kind: DestinationRule
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: details
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  host: details
</span></span><span class=line><span class=cl>  subsets:
</span></span><span class=line><span class=cl>    - name: v1
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        version: v1
</span></span><span class=line><span class=cl>    - name: v2
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        version: v2
</span></span></code></pre></div><p>This creates destination rules for each of the BookInfo services and defines version subsets</p><p>In a few seconds we should be able to verify the destination rules created by using the command below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get destinationrules
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get destinationrules -o yaml
</span></span></code></pre></div><h3 id=browse-to-bookinfo class=heading-link><strong>Browse to BookInfo</strong>
<a href=#browse-to-bookinfo class=heading-anchor aria-label="Permalink to this heading">🔗</a></h3><p>Browse to the website of the Bookinfo. To view the product page, you will have to append
<code>/productpage</code> to the url.</p><h4 id=reload-page class=heading-link><strong>Reload Page</strong>
<a href=#reload-page class=heading-anchor aria-label="Permalink to this heading">🔗</a></h4><p>Now, reload the page multiple times and notice how it round robins between v1, v2 and v3 of the reviews service.</p><h3 id=inspect-the-istio-proxy-of-the-productpage-pod class=heading-link><strong>Inspect the Istio proxy of the productpage pod</strong>
<a href=#inspect-the-istio-proxy-of-the-productpage-pod class=heading-anchor aria-label="Permalink to this heading">🔗</a></h3><p>To better understand the istio proxy, let&rsquo;s inspect the details. Let us <code>exec</code> into the productpage pod to find the proxy details. To do so we need to first find the full pod name and then <code>exec</code> into the istio-proxy container:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get pods
</span></span><span class=line><span class=cl>kubectl <span class=nb>exec</span> -it productpage-v1-... -c istio-proxy  sh
</span></span></code></pre></div><p>Once in the container look at some of the envoy proxy details by inspecting it&rsquo;s config file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ps aux
</span></span><span class=line><span class=cl>ls -l /etc/istio/proxy
</span></span><span class=line><span class=cl>cat /etc/istio/proxy/envoy-rev0.json
</span></span></code></pre></div><p>For more details on envoy proxy please check out their <a href=https://www.envoyproxy.io/docs/envoy/v1.5.0/operations/admin>admin docs</a>.</p><p>As a last step, lets exit the container:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>exit</span>
</span></span></code></pre></div><h4 id=alternative-manual-installation class=heading-link><strong>Alternative: Manual installation</strong>
<a href=#alternative-manual-installation class=heading-anchor aria-label="Permalink to this heading">🔗</a></h4><p>Follow this if the above steps did not work for you</p><br><br><h5 id=default-destination-rules class=heading-link><strong>Default destination rules</strong>
<a href=#default-destination-rules class=heading-anchor aria-label="Permalink to this heading">🔗</a></h5><p>Run the following command to create default destination rules for the Bookinfo services:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl apply -f samples/bookinfo/networking/destination-rule-all-mtls.yaml
</span></span></code></pre></div><h5 id=configure-the-bookinfo-route-with-the-istio-ingress-gateway class=heading-link><strong>Configure the Bookinfo route with the Istio Ingress gateway</strong>
<a href=#configure-the-bookinfo-route-with-the-istio-ingress-gateway class=heading-anchor aria-label="Permalink to this heading">🔗</a></h5><p>We can create a virtualservice & gateway for bookinfo app in the ingress gateway by running the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml
</span></span></code></pre></div></div><nav class="pagination-nav mt-5" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/deploy-an-application/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label><i class="fa fa-chevron-left"></i> Deploy a Sample Application</div></a><a class="pagination-nav__link pagination-nav__link--next" href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/observability/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Observability <i class="fa fa-chevron-right"></i></div></a></nav></div><div style=margin-top:2rem></div></main></div></div></div><script src=https://cloud.layer5.io/academy/js/main.min.93a3bf75eba7f67cb62933bdc16aff4dc235ec3930d0090a0bdf2a9941f29237.js integrity="sha256-k6O/deun9ny2KTO9wWr/TcI17Dkw0AkKC98qmUHykjc=" crossorigin=anonymous></script><script defer src=https://cloud.layer5.io/academy/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=https://cloud.layer5.io/academy/js/tabpane-persist.js></script><div id=myModal class=modal><button class=modal-close onclick=closeModal()>close</button><div class=modal-cont><img class=modal-pic id=modalPic onclick=closeModal() style=max-width:100%;max-height:80vh;margin:auto alt=Modal-pic></div></div><script>function openModal(e){var t;typeof e=="string"?t=document.getElementById(e).src:e instanceof HTMLImageElement&&(t=e.src),t&&t.includes("#")&&(t=t.substring(0,t.indexOf("#"))),document.getElementById("modalPic").src=t,document.getElementById("myModal").style.display="block"}function closeModal(){document.getElementById("modalPic").src="",document.getElementById("myModal").style.display="none"}document.addEventListener("keydown",function(e){e.key==="Escape"&&closeModal()}),document.addEventListener("DOMContentLoaded",function(){var e,t=document.querySelectorAll("img");t.forEach(function(e){e.onclick=function(){e.dataset.modal!=="false"&&openModal(e)}}),e=document.getElementById("myModal"),e.addEventListener("click",function(){closeModal()})})</script></body></html>