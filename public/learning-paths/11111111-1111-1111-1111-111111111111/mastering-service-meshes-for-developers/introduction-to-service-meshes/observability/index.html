<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=https://cloud.layer5.io/academy/favicons/favicon.ico><link rel=apple-touch-icon href=https://cloud.layer5.io/academy/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-192x192.png sizes=192x192><title>Observability | Layer5 Academy</title><meta name=description content="Meshery, collaborative Kubernetes manager"><meta property="og:url" content="https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/observability/"><meta property="og:site_name" content="Layer5 Academy"><meta property="og:title" content="Observability"><meta property="og:description" content="Meshery, collaborative Kubernetes manager"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="learning-paths"><meta itemprop=name content="Observability"><meta itemprop=description content="Meshery, collaborative Kubernetes manager"><meta itemprop=wordCount content="964"><meta name=twitter:card content="summary"><meta name=twitter:title content="Observability"><meta name=twitter:description content="Meshery, collaborative Kubernetes manager"><link rel=preload href=https://cloud.layer5.io/academy/scss/main.min.8d61368d36274adb6675933a7937cfa090b823abdb581eede811dfeab0c3628e.css as=style integrity="sha256-jWE2jTYnSttmdZM6eTfPoJC4I6vbWB7t6BHf6rDDYo4=" crossorigin=anonymous><link href=https://cloud.layer5.io/academy/scss/main.min.8d61368d36274adb6675933a7937cfa090b823abdb581eede811dfeab0c3628e.css rel=stylesheet integrity="sha256-jWE2jTYnSttmdZM6eTfPoJC4I6vbWB7t6BHf6rDDYo4=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="form-control td-search__input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=https://cloud.layer5.io/academy/offline-search-index.f16c09dddb81ca89db2c4b5cb89e7f49.json data-offline-search-base-href=https://cloud.layer5.io/academy/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developers-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developers><span>Mastering Service Meshes for Developers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshes-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshes><span>Introduction to Service Meshes</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesgetting-started-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesgetting-started><span>Getting Started with Istio</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesdeploy-an-application-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/deploy-an-application/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesdeploy-an-application><span>Deploy a Sample Application</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesexpose-services-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/expose-services/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesexpose-services><span>Exposing services through Istio Ingress Gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesobservability-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/observability/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesobservability><span class=td-sidebar-nav-active-item>Observability</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesrouting-and-canary-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/routing-and-canary/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesrouting-and-canary><span>Request Routing and Canary Testing</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesfault-injection-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/fault-injection/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesfault-injection><span>Fault Injection</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesmutual-tls-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/mutual-tls/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesmutual-tls><span>Mutual TLS & Identity Verification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshescircuit-breaking-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/circuit-breaking/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshescircuit-breaking><span>Circuit Breaking</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesconclusion-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/conclusion/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesconclusion><span>Conclusion</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshes-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshes><span>Advance Concepts of Service Meshes</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesgetting-started-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesgetting-started><span>Getting Started with Istio</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesdeploy-an-application-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/deploy-an-application/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesdeploy-an-application><span>Deploy a sample application</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesexpose-services-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/expose-services/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesexpose-services><span>Expose services through Istio Ingress Gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesservice-security-capabilities-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/service-security-capabilities/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesservice-security-capabilities><span>Service Security Capabilities of Istio</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-mesheswebassembly-and-intelligent-data-planes-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/webassembly-and-intelligent-data-planes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-mesheswebassembly-and-intelligent-data-planes><span>WebAssembly and Intelligent Data Planes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesconclusion-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/conclusion/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesconclusion><span>Conclusion</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesobservability-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/observability/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesobservability><span>Observability with Istio</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div></aside><main class="col-12 col-md-9 col-xl-8" role=main><div class="page-header d-flex justify-content-between align-items-center"><div class=breadcrumb-container><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/>Learning Paths</a></li><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/>Mastering Service Meshes for Developers</a></li><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/>Introduction to Service Meshes</a></li><li class="breadcrumb-item active" aria-current=page>Observability</li></ol></nav></div></div><div class=td-content data-bs-theme=dark><h1>Observability</h1><div class=lead>Meshery, collaborative Kubernetes manager</div><header class=article-meta><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 5 minute read &nbsp;</p></header><div class=chapter-content><h3 id=install-telemetry-add-ons class=heading-link><strong>Install Telemetry Add-ons</strong>
<a href=#install-telemetry-add-ons class=heading-anchor aria-label="Permalink to this heading">🔗</a></h3><p>Using Meshery, install Istio telemetry add-ons. In the Istio management page:</p><ol><li>Click the (+) icon on the <code>Apply Service Mesh Configuration</code> card.</li><li>Select each of the following add-ons:<ol><li><a href=https://prometheus.io/>Prometheus</a></li><li><a href=https://grafana.com/>Grafana</a></li><li><a href=https://www.jaegertracing.io/>Jaeger</a></li></ol></li></ol><p><div class=md__image><img id="[333 17 477 499 225 451]" src=https://cloud.layer5.io/academy/11111111-1111-1111-1111-111111111111/mastering-service-mesh/istio-addons.webp onclick=openModal(this.id) alt=istio-addons class=md-image-responsive></div></p><p>You will use Prometheus and Grafana for collecting and viewing metrics and <a href=https://www.jaegertracing.io/>Jaeger</a> collecting and viewing distributed traces. Expose each add-on external to the cluster. Each the service network typs are set to &ldquo;LoadBalancer&rdquo;.</p><h4 id=service-mesh-performance-and-telemetry class=heading-link><strong>Service Mesh Performance and Telemetry</strong>
<a href=#service-mesh-performance-and-telemetry class=heading-anchor aria-label="Permalink to this heading">🔗</a></h4><p>Many of the labs require load to be placed on the sample apps. Let&rsquo;s generate HTTP traffic against the BookInfo application, so we can see interesting telemetry.</p><p>Verify access through the Ingress Gateway:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get service istio-ingressgateway -n istio-system
</span></span></code></pre></div><p>Once we have the port, we can append the IP of one of the nodes to get the host.</p><p>The URL to run a load test against will be <code>http://&lt;IP/hostname of any of the nodes in the cluster>:&lt;ingress port>/productpage</code></p><p><strong>Please note:</strong> If you are using Docker Desktop, please use the IP address of your host. You can leave the port blank. For example: <code>http://1.2.3.4/productpage</code>. Managed kubernetes service users will need to use <code>http://&lt;external-ip of istio-ingressgateway>/productpage</code> as done in expose services section.</p><p>Use the computed URL above in Meshery, in the browser, to run a load test and see the results.</p><h5 id=connect-grafana-optionally-prometheus-to-meshery class=heading-link><strong>Connect Grafana (optionally, Prometheus) to Meshery.</strong>
<a href=#connect-grafana-optionally-prometheus-to-meshery class=heading-anchor aria-label="Permalink to this heading">🔗</a></h5><p>On the Settings page:</p><ol><li>Navigate to the <code>Metrics</code> tab.</li><li>Enter Grafana&rsquo;s URL:port number and submit.</li></ol><h5 id=use-meshery-to-generate-load-and-analyze-performance class=heading-link><strong>Use Meshery to generate load and analyze performance.</strong>
<a href=#use-meshery-to-generate-load-and-analyze-performance class=heading-anchor aria-label="Permalink to this heading">🔗</a></h5><p>On the Performance page:</p><ol><li>give this load test a memorable name</li><li>enter the URL to the BookInfo productpage</li><li>select <code>Istio</code> in the <code>Service Mesh</code> dropdown</li><li>enter a valid number for <code>Concurrent requests</code></li><li>enter a valid number for <code>Queries per second</code></li><li>enter a valid <code>Duration</code> (a number followed by <code>s</code> for seconds (OR) <code>m</code> for minutes (OR) <code>h</code> for hour)</li><li>use the host IP address in the request Tab and in the advanced options, type in the header as <code>Host:&lt;app-name></code></li></ol><p>Click on <code>Run Test</code>. A performance test will run and statistical analysis performed. Examine the results of the test and behavior of the service mesh.</p><p>Next, you will begin controlling requests to BookInfo using traffic management features.</p><br><h4 id=alternative-manual-installation class=heading-link><strong>Alternative: Manual installation</strong>
<a href=#alternative-manual-installation class=heading-anchor aria-label="Permalink to this heading">🔗</a></h4><p>Follow these steps if the above steps did not work<br><br></p><h5 id=install-add-ons class=heading-link><strong>Install Add-ons:</strong>
<a href=#install-add-ons class=heading-anchor aria-label="Permalink to this heading">🔗</a></h5><br><p><strong>Prometheus</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.7/samples/addons/prometheus.yaml
</span></span></code></pre></div><p><strong>Grafana</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.7/samples/addons/grafana.yaml
</span></span></code></pre></div><p><strong>Jaeger</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.7/samples/addons/jaeger.yaml
</span></span></code></pre></div><h5 id=exposing-services class=heading-link><strong>Exposing services</strong>
<a href=#exposing-services class=heading-anchor aria-label="Permalink to this heading">🔗</a></h5><p>Istio add-on services are deployed by default as <code>ClusterIP</code> type services. We can expose the services outside the cluster by either changing the Kubernetes service type to <code>NodePort</code> or <code>LoadBalancer</code> or by port-forwarding or by configuring Kubernetes Ingress.</p><p><strong>Option 1: Expose services with NodePort</strong>
To expose them using NodePort service type, we can edit the services and change the service type from <code>ClusterIP</code> to <code>NodePort</code></p><p><strong>Option 2: Expose services with port-forwarding</strong>
Port-forwarding runs in the foreground. We have appeneded <code>&</code> to the end of the above 2 commands to run them in the background. If you donot want this behavior, please remove the <code>&</code> from the end.</p><h5 id=prometheus class=heading-link><strong>Prometheus</strong>
<a href=#prometheus class=heading-anchor aria-label="Permalink to this heading">🔗</a></h5><p>You will need to expose the Prometheus service on a port either of the two following methods:</p><p><strong>Option 1: Expose services with NodePort</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system edit svc prometheus
</span></span></code></pre></div><p>To find the assigned ports for Prometheus:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system get svc prometheus
</span></span></code></pre></div><p><strong>Option 2: Expose Prometheus service with port-forwarding:</strong></p><p>Expose Prometheus service with port-forwarding:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system port-forward <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=k>$(</span>kubectl -n istio-system get pod -l <span class=nv>app</span><span class=o>=</span>prometheus -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.items[0].metadata.name}&#39;</span><span class=k>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  9090:9090 <span class=p>&amp;</span>
</span></span></code></pre></div><p>Browse to <code>http://&lt;ip>:&lt;port></code> and in the <code>Expression</code> input box enter: <code>istio_request_bytes_count</code>. Click the Execute button.</p><p><div class=md__image><img id="[146 368 42 98 221 387]" src=https://cloud.layer5.io/academy/11111111-1111-1111-1111-111111111111/mastering-service-mesh/Prometheus.webp onclick=openModal(this.id) alt=prometheus class=md-image-responsive></div></p><h5 id=grafana class=heading-link><strong>Grafana</strong>
<a href=#grafana class=heading-anchor aria-label="Permalink to this heading">🔗</a></h5><p>You will need to expose the Grafana service on a port either of the two following methods:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system edit svc grafana
</span></span></code></pre></div><p>Once this is done the services will be assigned dedicated ports on the hosts.</p><p>To find the assigned ports for Grafana:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system get svc grafana
</span></span></code></pre></div><p><strong>Expose Grafana service with port-forwarding:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system port-forward <span class=k>$(</span>kubectl -n istio-system get pod -l <span class=nv>app</span><span class=o>=</span>grafana <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.items[0].metadata.name}&#39;</span><span class=k>)</span> 3000:3000 <span class=p>&amp;</span>
</span></span></code></pre></div><p><div class=md__image><img id="[246 303 65 356 352 231]" src=https://cloud.layer5.io/academy/11111111-1111-1111-1111-111111111111/mastering-service-mesh/Grafana_Istio_Dashboard.webp onclick=openModal(this.id) alt=Grafana class=md-image-responsive></div></p><br><br>##### **Distributed Tracing**<p>The sample Bookinfo application is configured to collect trace spans using Zipkin or Jaeger. Although Istio proxies are able to automatically send spans, it needs help from the application to tie together the entire trace. To do this applications need to propagate the appropriate HTTP headers so that when the proxies send span information to Zipkin or Jaeger, the spans can be correlated correctly into a single trace.</p><p>To do this the application collects and propagates the following headers from the incoming request to any outgoing requests:</p><ul><li><code>x-request-id</code></li><li><code>x-b3-traceid</code></li><li><code>x-b3-spanid</code></li><li><code>x-b3-parentspanid</code></li><li><code>x-b3-sampled</code></li><li><code>x-b3-flags</code></li><li><code>x-ot-span-context</code></li></ul><p><div class=md__image><img id="[466 381 150 233 20 130]" src=https://cloud.layer5.io/academy/11111111-1111-1111-1111-111111111111/mastering-service-mesh/jaeger.webp onclick=openModal(this.id) alt=jaeger class=md-image-responsive></div></p><br><br><h5 id=exposing-services-1 class=heading-link><strong>Exposing services</strong>
<a href=#exposing-services-1 class=heading-anchor aria-label="Permalink to this heading">🔗</a></h5><p>Istio add-on services are deployed by default as <code>ClusterIP</code> type services. We can expose the services outside the cluster by either changing the Kubernetes service type to <code>NodePort</code> or <code>LoadBalancer</code> or by port-forwarding or by configuring Kubernetes Ingress. In this lab, we will briefly demonstrate the <code>NodePort</code> and port-forwarding ways of exposing services.</p><h5 class=chapter-alt-heading>Option 1: Expose services with NodePort</h5><p>To expose them using NodePort service type, we can edit the services and change the service type from <code>ClusterIP</code> to <code>NodePort</code></p><p>For Jaeger, either of <code>tracing</code> or <code>jaeger-query</code> can be exposed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system edit svc tracing
</span></span></code></pre></div><p>Once this is done the services will be assigned dedicated ports on the hosts.</p><p>To find the assigned ports for Jaeger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system get svc tracing
</span></span></code></pre></div><h5 class=chapter-alt-heading>Option 2: Expose services with port-forwarding</h5><p>To port-forward Jaeger:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system port-forward <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=k>$(</span>kubectl -n istio-system get pod -l <span class=nv>app</span><span class=o>=</span>jaeger -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.items[0].metadata.name}&#39;</span><span class=k>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  16686:16686 <span class=p>&amp;</span>
</span></span></code></pre></div><h5 id=view-traces class=heading-link><strong>View Traces</strong>
<a href=#view-traces class=heading-anchor aria-label="Permalink to this heading">🔗</a></h5><p>Let us find the port Jaeger is exposed on by running the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl -n istio-system get svc tracing
</span></span></code></pre></div><p>You can click on the link at the top of the page which maps to the right port and it will open Jaeger UI in a new tab.</p></div><nav class="pagination-nav mt-5" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/expose-services/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label><i class="fa fa-chevron-left"></i> Exposing services through Istio Ingress Gateway</div></a><a class="pagination-nav__link pagination-nav__link--next" href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/routing-and-canary/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Request Routing and Canary Testing <i class="fa fa-chevron-right"></i></div></a></nav></div><div style=margin-top:2rem></div></main></div></div></div><script src=https://cloud.layer5.io/academy/js/main.min.93a3bf75eba7f67cb62933bdc16aff4dc235ec3930d0090a0bdf2a9941f29237.js integrity="sha256-k6O/deun9ny2KTO9wWr/TcI17Dkw0AkKC98qmUHykjc=" crossorigin=anonymous></script><script defer src=https://cloud.layer5.io/academy/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=https://cloud.layer5.io/academy/js/tabpane-persist.js></script><div id=myModal class=modal><button class=modal-close onclick=closeModal()>close</button><div class=modal-cont><img class=modal-pic id=modalPic onclick=closeModal() style=max-width:100%;max-height:80vh;margin:auto alt=Modal-pic></div></div><script>function openModal(e){var t;typeof e=="string"?t=document.getElementById(e).src:e instanceof HTMLImageElement&&(t=e.src),t&&t.includes("#")&&(t=t.substring(0,t.indexOf("#"))),document.getElementById("modalPic").src=t,document.getElementById("myModal").style.display="block"}function closeModal(){document.getElementById("modalPic").src="",document.getElementById("myModal").style.display="none"}document.addEventListener("keydown",function(e){e.key==="Escape"&&closeModal()}),document.addEventListener("DOMContentLoaded",function(){var e,t=document.querySelectorAll("img");t.forEach(function(e){e.onclick=function(){e.dataset.modal!=="false"&&openModal(e)}}),e=document.getElementById("myModal"),e.addEventListener("click",function(){closeModal()})})</script></body></html>